<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zarządzanie mockupami etui</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: #f5f5f5;
        padding: 20px;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h1 {
        text-align: center;
        margin-bottom: 20px;
        color: #333;
      }

      #file-input {
        display: none;
      }

      .nav-buttons {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .back-btn {
        padding: 10px 20px;
        background-color: #95a5a6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
        text-decoration: none;
        display: inline-block;
      }

      .back-btn:hover {
        background-color: #7f8c8d;
      }

      .requirements {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: 1px solid #dee2e6;
      }

      .requirements h3 {
        margin-bottom: 10px;
        color: #2c3e50;
      }

      .requirements ul {
        margin-left: 20px;
      }

      .requirements li {
        margin-bottom: 5px;
      }

      /* Styles for mockup gallery */
      .existing-mockups {
        margin-top: 30px;
        margin-bottom: 30px;
        position: relative;
      }

      .existing-mockups.dragover {
        outline: 2px dashed #3498db;
        outline-offset: 8px;
        background-color: rgba(52, 152, 219, 0.05);
      }

      .existing-mockups h3 {
        margin-bottom: 15px;
        color: #2c3e50;
        text-align: center;
      }

      .mockup-gallery {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        min-height: 200px;
      }

      .mockup-item {
        position: relative;
        border: 3px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        aspect-ratio: 1/1;
        background-color: white;
        display: flex;
        flex-direction: column;
      }

      .mockup-thumbnail {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        cursor: pointer;
      }

      .mockup-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .mockup-item.active {
        border: 3px solid #3498db;
      }

      .mockup-controls {
        display: flex;
        justify-content: space-between;
        padding: 8px;
        background-color: #f8f9fa;
      }

      .mockup-number {
        font-weight: bold;
        color: #333;
        padding: 4px 8px;
      }

      .mockup-actions {
        display: flex;
        gap: 5px;
      }

      .action-btn {
        width: 26px;
        height: 26px;
        border-radius: 4px;
        border: none;
        background-color: #e0e0e0;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: all 0.2s;
      }

      .action-btn:hover {
        background-color: #d0d0d0;
      }

      .action-btn.delete {
        background-color: #e74c3c;
        color: white;
      }

      .action-btn.delete:hover {
        background-color: #c0392b;
      }

      /* Style for loading indicator */
      .loading-indicator {
        text-align: center;
        color: #666;
        margin: 20px 0;
      }

      .section-header {
        margin: 20px 0;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .no-mockups {
        text-align: center;
        color: #999;
        padding: 40px;
      }

      .add-new-btn {
        margin-left: auto;
        margin-right: auto;
        display: block;
        margin-bottom: 30px;
        padding: 12px 24px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
      }

      .add-new-btn:hover {
        background-color: #2980b9;
      }

      .upload-indicator {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10;
        display: none;
      }

      .upload-indicator-text {
        font-size: 24px;
        color: #333;
        margin-bottom: 15px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .mockup-gallery {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="nav-buttons">
        <a href="index.html" class="back-btn">← Powrót do edytora</a>
      </div>

      <h1>Zarządzanie mockupami etui</h1>

      <div class="requirements">
        <h3>Wymagania dla mockupów:</h3>
        <ul>
          <li>Format PNG z przezroczystym tłem</li>
          <li>
            Mockup powinien przedstawiać obrys telefonu z przezroczystą częścią
            w miejscu, gdzie będzie wstawiony obraz
          </li>
          <li>Zmiany w mockupach będą dostępne w edytorze po odświeżeniu strony</li>
        </ul>
      </div>

      <!-- Existing mockups section -->
      <div class="existing-mockups" id="existing-mockups">
        <div class="section-header">
          <h3>Istniejące mockupy</h3>
        </div>
        <div class="loading-indicator" id="loading-indicator">Wczytywanie dostępnych mockupów...</div>
        <div class="mockup-gallery" id="mockup-gallery">
          <!-- Mockupy zostaną dodane dynamicznie przez JavaScript -->
        </div>
        <div class="no-mockups" id="no-mockups" style="display: none;">
          Nie znaleziono żadnych mockupów. Dodaj nowe mockupy, aby rozpocząć.
        </div>
        <div class="upload-indicator" id="upload-indicator">
          <div class="upload-indicator-text">Zapisywanie mockupów...</div>
        </div>
      </div>

      <!-- Button to add new mockups -->
      <button class="add-new-btn" id="add-new-btn">+ Dodaj nowe mockupy</button>
      <input type="file" id="file-input" accept="image/png" multiple />

    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Elements
        const fileInput = document.getElementById("file-input");
        const mockupGallery = document.getElementById("mockup-gallery");
        const loadingIndicator = document.getElementById("loading-indicator");
        const noMockups = document.getElementById("no-mockups");
        const addNewBtn = document.getElementById("add-new-btn");
        const existingMockups = document.getElementById("existing-mockups");
        const uploadIndicator = document.getElementById("upload-indicator");
        
        // Obsługa kliknięcia przycisku dodawania nowych mockupów
        addNewBtn.addEventListener("click", () => {
          fileInput.click();
        });
        
        // Lista dostępnych mockupów
        let mockupFiles = [];
        let mockupItems = [];
        
        // Funkcja sprawdzająca dostępność pliku
        async function checkFileExists(url) {
          try {
            const response = await fetch(url, { method: "HEAD" });
            return response.ok;
          } catch (error) {
            console.error("Błąd sprawdzania pliku:", error);
            return false;
          }
        }

        // Funkcja skanująca dostępne mockupy
        async function scanMockups() {
          const mockupFolder = "./mockup/"; // Folder z mockupami
          const maxFilesToCheck = 50; // Maksymalna liczba plików do sprawdzenia

          mockupFiles = [];
          
          // Sprawdź dostępność każdego pliku od 1.png do maxFilesToCheck.png
          for (let i = 1; i <= maxFilesToCheck; i++) {
            const fileName = `${i}.png`;
            const filePath = `${mockupFolder}${fileName}`;

            const exists = await checkFileExists(filePath);
            if (exists) {
              mockupFiles.push({
                path: filePath,
                id: i,
                fileName: fileName
              });
            }
          }

          // Jeśli nie znaleziono żadnych plików w folderze mockup, sprawdź w folderze głównym
          if (mockupFiles.length === 0) {
            for (let i = 1; i <= maxFilesToCheck; i++) {
              const fileName = `${i}.png`;
              const filePath = `./${fileName}`;

              const exists = await checkFileExists(filePath);
              if (exists) {
                mockupFiles.push({
                  path: filePath,
                  id: i,
                  fileName: fileName
                });
              }
            }
          }

          return mockupFiles;
        }

        // Funkcja generująca interface zarządzania mockupami
        function generateMockupManager(mockups) {
          mockupGallery.innerHTML = ""; // Wyczyść galerię

          if (mockups.length === 0) {
            noMockups.style.display = "block";
            return;
          } else {
            noMockups.style.display = "none";
          }

          // Sortuj mockupy według ID
          mockups.sort((a, b) => a.id - b.id);

          mockups.forEach((mockup, index) => {
            const itemHTML = `
              <div class="mockup-item" data-id="${mockup.id}" data-path="${mockup.path}">
                <div class="mockup-thumbnail">
                  <img src="${mockup.path}" alt="Mockup ${mockup.id}" />
                </div>
                <div class="mockup-controls">
                  <div class="mockup-number">#${mockup.id}</div>
                  <div class="mockup-actions">
                    <button class="action-btn delete" title="Usuń mockup">×</button>
                  </div>
                </div>
              </div>
            `;

            mockupGallery.innerHTML += itemHTML;
          });

          // Przypisz obsługę przycisków do nowo wygenerowanych elementów
          setupMockupItemListeners();
        }

        // Funkcja przypisująca obsługę interakcji do elementów mockupów
        function setupMockupItemListeners() {
          mockupItems = document.querySelectorAll(".mockup-item");
          
          mockupItems.forEach((item) => {
            // Przycisk usuwania mockupu
            const deleteBtn = item.querySelector(".action-btn.delete");
            deleteBtn.addEventListener("click", function(e) {
              e.stopPropagation();
              
              if (confirm("Czy na pewno chcesz usunąć ten mockup?")) {
                // W rzeczywistej implementacji tutaj byłby kod do usunięcia pliku na serwerze
                item.remove();
                
                // Sprawdź, czy usunięto wszystkie mockupy
                if (document.querySelectorAll(".mockup-item").length === 0) {
                  noMockups.style.display = "block";
                }
              }
            });
            
            // Obsługa kliknięcia na miniaturkę (zaznaczenie/odznaczenie)
            const thumbnail = item.querySelector(".mockup-thumbnail");
            thumbnail.addEventListener("click", function() {
              item.classList.toggle("active");
            });
          });
        }

        // Inicjalizacja galerii mockupów
        async function initializeMockupGallery() {
          try {
            // Pokaż wskaźnik ładowania
            loadingIndicator.style.display = "block";
            
            // Skanuj dostępne mockupy
            const availableMockups = await scanMockups();
            
            // Ukryj wskaźnik ładowania
            loadingIndicator.style.display = "none";
            
            // Generuj interfejs zarządzania mockupami
            generateMockupManager(availableMockups);
          } catch (error) {
            console.error("Błąd inicjalizacji galerii mockupów:", error);
            loadingIndicator.textContent = "Błąd wczytywania mockupów.";
          }
        }

        // Inicjalizacja galerii po załadowaniu strony
        initializeMockupGallery();

        // Obsługa wyboru plików przez input
        fileInput.addEventListener("change", handleFiles);

        // Obsługa drag & drop na całym obszarze istniejących mockupów
        ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
          existingMockups.addEventListener(eventName, preventDefaults);
        });

        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }

        ["dragenter", "dragover"].forEach((eventName) => {
          existingMockups.addEventListener(eventName, () => {
            existingMockups.classList.add("dragover");
          });
        });

        ["dragleave", "drop"].forEach((eventName) => {
          existingMockups.addEventListener(eventName, () => {
            existingMockups.classList.remove("dragover");
          });
        });

        existingMockups.addEventListener("drop", (e) => {
          const dt = e.dataTransfer;
          const files = dt.files;
          handleFiles({ target: { files } });
        });

        // Funkcja obsługująca wgrane pliki
        function handleFiles(e) {
          const files = e.target.files;

          if (files.length === 0) {
            return;
          }

          // Sprawdź, czy wszystkie pliki są w formacie PNG
          let allPNG = true;
          for (let i = 0; i < files.length; i++) {
            if (!files[i].type.match("image/png")) {
              allPNG = false;
              break;
            }
          }

          if (!allPNG) {
            alert("Można wgrać tylko pliki PNG! Wybierz ponownie.");
            return;
          }
          
          // Pokaż wskaźnik uploadu
          uploadIndicator.style.display = "flex";
          
          // W prawdziwej aplikacji tutaj byłby kod do zapisywania plików na serwerze
          // Symulujemy proces zapisywania plików
          setTimeout(() => {
            // Ukryj wskaźnik uploadu
            uploadIndicator.style.display = "none";
            
            // Zapisz informację, że mockupy zostały dodane (w prawdziwej aplikacji byłoby to na serwerze)
            localStorage.setItem("mockupsAdded", "true");
            
            alert(`Pomyślnie dodano ${files.length} mockup${files.length > 1 ? "ów" : ""}!`);
            
            // Odśwież galerię istniejących mockupów
            initializeMockupGallery();
            
            // Resetuj input, aby możliwe było wybranie tych samych plików ponownie
            fileInput.value = "";
          }, 2000);
        }
      });
    </script>
    <script src="./js/auth.js"></script>
  </body>
</html>